## FreeIPA  сервер и клиент, для централизованного хранения и управления учетными записями пользователей

Для запуска стенда необходимо:
1. Скопировать все содержимое каталога, где расположен этот [README.md](./)

2. Если необходимо, то  указать свой пароль для пользователя admin, отредактировав значение переменной в файле [credentials.yml](./playbooks/creds/credentials.yml). Пароль в данном случае не зашифрован, т.к. в шифровании его нет необходимости, а в целом, если все же креды надо хранить в репе, то их необходимо шифровать с помощью ansible-vault. Чтобы пароль для дешифровки не вводить, можно за пределами репозитария разместить файл с паролем,  который вводили при шифровании кредов и указать в это в [ansible.cfg](./ansible.cfg) в виде параметра *vault_password_file = ~/.vault_pass.txt*

3. Если необходимо, то меняем параметры в Vagrantfile на необходимые, или же оставляем все по умолчанию.

      ```
      "ipa_server_ip" => "10.10.10.10",
      "ipa_client_ip" => "10.10.10.20",
      "ipa_server" =>"ipaserver",
      "ipa_client" => "ipaclient01",
      "domain_name" => "mydomain.local",
      "realm" => "MYDOMAIN.LOCAL",
      "odmin_name" => "admin",
      "creds_file_path" => "./creds/credentials.yml"
      ```

4. Запускаем vagrant up  и ждем пока все это проинсталится и настроится, у меня этот стенд запускался не менее получаса =).

5. когда все успешно установилось и настроилось, то на клиента и сервер можно будет зайти по ssh с учетной записью admin, пароль в файле credentials.yml

6. Если необходимо зайти на web интерфейс FreeIPA сервиса, то на хостовой машине в файл hosts  необходимо прописать:
    ```
    10.10.10.10 ipaserver.mydomain.local
    ``` 
  ну или то, что было задано в vagrantfile, по IP зайти не получится, а DNS сервера ничего не знают о нашем самопровозглашенном великом домене MYDOMAIN.LOCAL.

7. Добавлять пользователей можно не только из web GUI, но и из консоли.

    7.1. в одну строку
    ```
    ipa user-add jlamb --first=John --last=Lamb --password
    ```
    7.2. Интерактив:
     ```
    ipa user-add
    ```
Пользователь зарегистрированный в домене MYDOMAIN.LOCAL сможет зайти на любую машину, которая подключена к этому домену с freeIPA  клиентом.
